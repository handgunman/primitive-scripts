//Примерный фрагмент кода преоразования и сохранения результата запроса к регистрам и справочникам
//в формате CSV. Используется построитель отчетов. Результат пригодин для загрузки в БД ClickHouse
//или для обработки с помощью Yandex Query

Процедура СохранитьCSVНажатие(Элемент)	
Если РезультатТаблица.Количество() > 0 Тогда	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
	Диалог.Фильтр = "Текст(*.CSV)|*.CSV";
	Если Диалог.Выбрать() Тогда
		
     	Каталог = Диалог.ПолноеИмяФайла;
				
		ТД = Новый ТабличныйДокумент; //под данные Таблицы значений
		ПОРезультат = Новый ПостроительОтчета; //Преобразователь
		
		ПОРезультат.ИсточникДанных = Новый ОписаниеИсточникаДанных(РезультатТаблица);

		
		ПОРезультат.Макет = Неопределено;
		Макет = ПОРезультат.Макет;
		Макет.Область().Формат = "ЧРД = '.'; ЧГ=0; ДФ = 'yyyy-MM-dd HH:mm:ss'; БЛ='0'; БИ='1';";
			
		Макет.Область().РастягиватьПоГоризонтали = Истина;
		ПОРезультат.Макет = Макет;
		ПОРезультат.ВыводитьПодвалОтчета = Ложь;
		ПОРезультат.ВыводитьЗаголовокОтчета = Ложь;
		ПОРезультат.ВыводитьПодвалТаблицы = Ложь;	
				
		ПОРезультат.Вывести(ТД);        //Выводим в документ
		
		ТД.Записать(Каталог, ТипФайлаТабличногоДокумента.txt);  //Пишем в файл
			
		ТекстИзФайла = Новый ТекстовыйДокумент;
		ТекстИзФайла.Прочитать(Каталог);
		Текст = ТекстИзФайла.ПолучитьТекст();
		
		Текст = СтрЗаменить(Текст,"|","\|");//заменяем | на экранированные
		Текст = СтрЗаменить(Текст,Символы.Таб,"|");//заменяем разделители табами на |	
		Текст = СтрЗаменить(Текст,Символы.ПС + Символы.ПС + символы.ПС, ""); //убираем красивости
		Текст = СтрЗаменить(Текст,Символы.ПС + Символы.ПС, "");
		Текст = СтрЗаменить(Текст,Символы.ПС + "|", Символы.ПС);
		
		ТекстИзФайла.УстановитьТекст(Прав(Текст,СтрДлина(Текст)-1));
		
		ТекстИзФайла.Записать(Каталог,КодировкаТекста[ПолеВыбораКодировка]);    
		
		Предупреждение("Файл " +Каталог +" сохранен.");
	КонецЕсли;	
Иначе
	Предупреждение("Выполните запрос.");	
Конецесли;	
КонецПроцедуры
